"use strict";(()=>{var t=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},e=(e,i,s)=>(t(e,i,"read from private field"),s?s.call(e):i.get(e)),i=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},s=(e,i,s,n)=>(t(e,i,"write to private field"),n?n.call(e,s):i.set(e,s),s),n=(e,i,s)=>(t(e,i,"access private method"),s);async function o(t){return new Promise((e=>setTimeout(e,t)))}async function a(t,e=100){for(;!t();)await o(e)}var r=class{get width(){return this.right-this.left}get height(){return this.bottom-this.top}get center(){return new h(this.left+this.width/2,this.top+this.height/2)}get min(){return new h(this.left,this.top)}get max(){return new h(this.right,this.bottom)}constructor(t,e,i,s){this.left=t,this.top=e,this.right=t+i,this.bottom=e+s}contains(t){return t.x>=this.left&&t.x<=this.right&&t.y>=this.top&&t.y<=this.bottom}encapsulate(t){return this.left=Math.min(this.left,t.left),this.top=Math.min(this.top,t.top),this.right=Math.max(this.right,t.right),this.bottom=Math.max(this.bottom,t.bottom),this}encapsulatePoint(t){if(!t.isUndefined)return this.left=Math.min(this.left,t.x),this.top=Math.min(this.top,t.y),this.right=Math.max(this.right,t.x),this.bottom=Math.max(this.bottom,t.y),this}expand(t){return this.left-=t,this.right+=t,this.top-=t,this.bottom+=t,this}translate(t){return this.left+=t.x,this.right+=t.x,this.top+=t.y,this.bottom+=t.y,this}scale(t){return this.left*=t/2,this.right*=t/2,this.top*=t/2,this.bottom*=t/2,this}static fromElement(t){const e=t.getBoundingClientRect();return new r(e.x,e.y,e.width,e.height)}},l=class{constructor(t,e){this.x=t,this.y=e}add(t){return new l(this.x+t.x,this.y+t.y)}sub(t){return new l(this.x-t.x,this.y-t.y)}scale(t){return new l(this.x*t,this.y*t)}divide(t){return new l(this.x/t,this.y/t)}get isUndefined(){return isNaN(this.x)||isNaN(this.y)}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalized(){const t=this.magnitude;return new l(this.x/t,this.y/t)}get inverse(){return new l(-this.x,-this.y)}static distance(t,e){return t.sub(e).magnitude}static dot(t,e){return t.x*e.x+t.y*e.y}},h=l;h.Undefined=new l(NaN,NaN);var c=class{constructor(t){this.callbacks=[],this.targetFPS=t,this.measuredFPS=t,this._lastTime=performance.now(),this._deltaTime=1/t,this._time=this._lastTime}get deltaTime(){return this._deltaTime/1e3}get time(){return this._time}async start(){for(;;){this._time=performance.now(),requestAnimationFrame((()=>{for(let t of this.callbacks)t(this.deltaTime)}));const t=this._time-this._lastTime;let e=t-1e3/this.targetFPS;this._lastTime=this._time+Math.max(e,0),await o(Math.max(0,e)),this._deltaTime=Math.min(t+Math.max(e,0),1e3/this.targetFPS*3),this.measuredFPS=1/this.deltaTime*.1+.9*this.measuredFPS}}add(t){this.callbacks.push(t)}};function d(t,e=500){"none"!==t.style.display&&(t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=e+"ms",t.style.boxSizing="border-box",t.style.height=t.offsetHeight+"px",t.offsetHeight,t.style.overflow="hidden",t.style.height="0",t.style.paddingTop="0",t.style.paddingBottom="0",t.style.marginTop="0",t.style.marginBottom="0",window.setTimeout((async()=>{t.style.display="none",t.style.removeProperty("height"),t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property")}),e))}function u(t,e=500){if("none"!==window.getComputedStyle(t).display)return;t.style.removeProperty("display");let i=window.getComputedStyle(t).display;"none"===i&&(i="block"),t.style.display=i;const s=t.offsetHeight;t.style.overflow="hidden",t.style.height="0",t.style.paddingTop="0",t.style.paddingBottom="0",t.style.marginTop="0",t.style.marginBottom="0",t.offsetHeight,t.style.boxSizing="border-box",t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=e+"ms",t.style.height=s+"px",t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),window.setTimeout((async()=>{t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property")}),e)}function p(t){const e=t instanceof TouchEvent?Array.from(t.touches):[],i=e.length>0&&t instanceof TouchEvent?e.reduce(((t,e)=>t+e.clientX),0)/e.length:t.clientX,s=e.length>0&&t instanceof TouchEvent?e.reduce(((t,e)=>t+e.clientY),0)/e.length:t.clientY;return new h(i,s)}function m(t){return{x:t.clientX,y:t.clientY}}var g,f,y,E,b,v=class{constructor(t,e){this.isFocused=!1,this.canvas=t,this.nodeEl=e,this.labelEl=e.querySelector(".canvas-node-label"),this.containerEl=e.querySelector(".canvas-node-container"),this.contentEl=e.querySelector(".canvas-node-content");const i=this.contentEl.classList;if(i.contains("image-embed")?this.type="image":i.contains("video-embed")?this.type="video":i.contains("audio-embed")?this.type="audio":i.contains("markdown-embed")&&i.contains("is-loaded")?this.type="external-markdown":i.contains("markdown-embed")?this.type="markdown":i.contains("canvas-embed")?this.type="canvas":"IFRAME"===this.contentEl.firstElementChild?.tagName?this.type="website":this.nodeEl.classList.contains("canvas-node-group")?this.type="group":this.type="none","external-markdown"==this.type){const e=this.contentEl.querySelector(".markdown-embed-content"),i=t.document.children.find((t=>t.containerEl==e));i?this.document=i:console.error("Failed to find document object for external markdown node",this)}this.initEvents()}get bounds(){return r.fromElement(this.nodeEl)}get label(){return this.labelEl.textContent??""}set label(t){this.labelEl.textContent=t}get isScrollable(){return!!this.document&&this.document?.documentEl.scrollHeight>this.document?.documentEl.clientHeight}get scrollContainer(){return this.document?.documentEl}focus(t=!0){this.isFocused&&t||(this.canvas.focusedNode!=this&&this.canvas.focusedNode?.focus(!1),this.nodeEl.classList.toggle("is-focused",t),this.canvas.focusedNode=t?this:null,this.isFocused=t)}initEvents(){const t=this;function e(){console.log("leave"),t.focus(!1),t.nodeEl.removeEventListener("mouseleave",e),t.nodeEl.removeEventListener("touchend",e)}this.nodeEl.addEventListener("dblclick",(e=>{t.fitToView(.3)})),this.nodeEl.addEventListener("pointerenter",(function(i){t.focus(!0),t.nodeEl.addEventListener("mouseleave",e),t.nodeEl.addEventListener("touchend",e),i.stopPropagation()}))}fitToView(t=0){this.canvas.fitToBounds(this.bounds,.9,t)}},w=class{constructor(t){this.focusedNode=null,this.minScale=.1,this.maxScale=1.5,this._scale=1,this._backgroundScale=20,this._backgroundPosition=new h(0,0),this.document=t,this.nodes=Array.from(t.documentEl.querySelectorAll(".canvas-node")).map((t=>new v(this,t))),this.document.documentEl.style.position="absolute",this.document.documentEl.style.width="100%",this.document.documentEl.style.height="100%",this.document.documentEl.style.overflow="hidden",this.document.documentEl.style.top="0",this.document.documentEl.style.left="0",this.canvasEl=t.documentEl.querySelector(".canvas"),this.wrapperEl=t.documentEl.querySelector(".canvas-wrapper"),this.backgroundEl=t.documentEl.querySelector(".canvas-background pattern"),this.canvasEl.setAttribute("style","translate: 0px 1px; scale: 1;"),this.backgroundScale=20;const e=r.fromElement(this.canvasEl).min.sub(this.nodeBounds.min);Array.from(this.canvasEl.children).forEach((t=>{t.style.translate=`${e.x}px ${e.y}px`})),this.position=this.nodeBounds.min.sub(this.wrapperBounds.min),this.initEvents(),this.fitToBounds(this.nodeBounds,3),this.fitToBounds(this.nodeBounds,.9,.3)}get nodeBounds(){if(0==this.nodes.length)return new r(0,0,0,0);const t=this.nodes[0].bounds;for(const e of this.nodes)t.encapsulate(e.bounds);return t}get wrapperBounds(){return r.fromElement(this.wrapperEl)}get scale(){return this._scale}set scale(t){const e=(t=Math.min(Math.max(t,this.minScale),this.maxScale)).toString()??"1";this.canvasEl.style.scale=e;const i=(1/Math.sqrt(t)).toString()??"1";this.wrapperEl.style.setProperty("--zoom-multiplier",i),this._scale=t}get position(){return this._position}set position(t){this._position=t,this.canvasEl.style.translate=`${t.x}px ${t.y}px`}get backgroundScale(){return this._backgroundScale}set backgroundScale(t){const e=t.toString()??"20";this.backgroundEl.setAttribute("width",e),this.backgroundEl.setAttribute("height",e),this._backgroundScale=t}get backgroundPosition(){return this._backgroundPosition}set backgroundPosition(t){this.backgroundEl.setAttribute("x",t.x.toString()),this.backgroundEl.setAttribute("y",t.y.toString()),this._backgroundPosition=t}initEvents(){const t=this,e=navigator.userAgent.includes("Windows");function i(t,e,i){const s=i?.scrollContainer;if(s){if(0!=s.scrollTop&&t<0&&Math.abs(t/(e+.01))>2)return!1;if(s.scrollHeight-s.scrollTop>s.clientHeight+1&&t>0&&Math.abs(t/(e+.01))>2)return!1;if(0!=s.scrollLeft&&e<0&&Math.abs(e/(t+.01))>2)return!1;if(s.scrollWidth-s.scrollLeft>s.clientWidth+1&&e>0&&Math.abs(e/(t+.01))>2)return!1}return!0}this.backgroundEl.parentElement?.addEventListener("dblclick",(()=>{console.log("fitting to bounds"),t.fitToBounds(this.nodeBounds,.9,.3)})),this.wrapperEl.addEventListener("pointerdown",(function(i){if("mouse"!=i.pointerType&&"pen"!=i.pointerType)return;const s=p(i),n=t.position,o=t.focusedNode;function a(i){if(e&&o?.isScrollable&&4==i.buttons)return;i.preventDefault();const a=p(i).sub(s);t.position=n.add(a)}document.body.addEventListener("mousemove",a),document.body.addEventListener("mouseup",(function t(e){document.body.removeEventListener("mousemove",a),document.body.removeEventListener("mouseup",t)}))})),this.wrapperEl.addEventListener("wheel",(function(e){if(!i(e.deltaY,e.deltaX,t.focusedNode))return;let s=1;s-=e.deltaY/700*s,t.scaleAround(s,p(e))}),{passive:!0});let s=!1;this.wrapperEl.addEventListener("touchstart",(function(e){if(s)return;s=!0;const n=e.touches;function o(t){const e=new h(t[0].clientX,t[0].clientY),i=2==t.length?new h(t[1].clientX,t[1].clientY):null,s=i?e.add(i).scale(.5):e;return{touch1:e,touch2:i,center:s,distance:i?h.distance(e,i):0}}let a=o(n),r=2==n.length;const l=t.focusedNode;function c(e){const s=e.touches,n=o(s);if(2==s.length){r||(a=o(s),r=!0);const e=(n.distance-a.distance)/a.distance;t.scaleAround(1+e,n.center)}const h=n.center.sub(a.center);r||i(-h.y,h.x,l)?(e.preventDefault(),t.position=t.position.add(h),a=o(s)):a=o(s)}document.body.addEventListener("touchmove",c),document.body.addEventListener("touchend",(function t(e){document.body.removeEventListener("touchmove",c),document.body.removeEventListener("touchend",t),s=!1}))}))}scaleAround(t,e){const i=this.scale;let s=i*t;s=Math.min(Math.max(s,this.minScale),this.maxScale),t=s/i;const n=e.sub(this.position).scale(t).add(this.position),o=e.sub(n);return this.scale*=t,this.position=this.position.add(o),o}setScaleAround(t,e){this.scaleAround(t/this.scale,e)}fitToBounds(t=this.nodeBounds,e=.9,i=0){if(i>0){const t=this.canvasEl;t.style.transition=`scale ${i}s cubic-bezier(0.5, -0.1, 0.5, 1.1), translate ${i}s cubic-bezier(0.5, -0.1, 0.5, 1.1)`,setTimeout((function(){t.style.transition=""}),1e3*i+50)}const s=this.document.containerEl.clientWidth,n=this.document.containerEl.clientHeight,o=s/t.width,a=n/t.height,r=e*Math.min(o,a);this.scaleAround(r,t.center),this.centerView(t.center)}centerView(t){const e=this.wrapperBounds.center.sub(t);this.position=this.position.add(e)}},S=class{constructor(t,e){console.log("PageFeature constructor"),this.parent=document.querySelector(t.relationSelector),this.parent||(this.parent=ObsidianSite.document.footerEl??ObsidianSite.document.headerEl??ObsidianSite.document.sizerEl??ObsidianSite.document.documentEl),this.title=t.displayTitle,this.containerEl=document.createElement("div"),this.containerEl.classList.add(e+"-container"),this.containerEl.classList.add("hide"),this.parent.appendChild(this.containerEl),this.title&&this.title.length>0&&(this.titleEl=document.createElement("div"),this.titleEl.classList.add("feature-title"),this.titleEl.innerText=this.title,this.containerEl.appendChild(this.titleEl)),this.contentEl=document.createElement("div"),this.contentEl.classList.add(e+"-content"),this.containerEl.appendChild(this.contentEl),console.log(this.containerEl),setTimeout((()=>this.containerEl.classList.remove("hide")),0)}},k=class{get url(){return this._url}constructor(t,e){this.targetData=ObsidianSite.getWebpageData(e),this.targetData?(this._url=e,this.backlinkEl=document.createElement("a"),this.backlinkEl.href=e,this.backlinkEl.classList.add("backlink"),t.appendChild(this.backlinkEl),this.backlinkIconEl=document.createElement("div"),this.backlinkIconEl.classList.add("backlink-icon"),this.backlinkIconEl.innerHTML=this.targetData.icon,this.backlinkEl.appendChild(this.backlinkIconEl),this.backlinkTitleEl=document.createElement("div"),this.backlinkTitleEl.classList.add("backlink-title"),this.backlinkTitleEl.innerText=this.targetData.title,this.backlinkEl.appendChild(this.backlinkTitleEl),this.backlinkEl.addEventListener("click",(t=>{t.preventDefault(),ObsidianSite.loadURL(this.url)}))):console.error("Failed to find target for backlink",e)}},L=class extends S{constructor(t){super(ObsidianSite.metadata.featureOptions.backlinks,"backlinks"),this.backlinks=t.map((t=>new k(this.contentEl,t)))}},C=class{constructor(t,e=!0){this._collapsed=!1,this.calloutEl=t,this.titleEl=t.querySelector(".callout-title-inner"),this.contentEl=t.querySelector(".callout-content"),this.iconEl=t.querySelector(".callout-icon"),this.foldIconEl=t.querySelector(".callout-fold");switch(t.getAttribute("data-callout-fold")){case"+":this.foldType=0,this._collapsed=!1;break;case"-":this.foldType=1,this._collapsed=!0;break;default:this.foldType=2,this._collapsed=!1}this.type=t.getAttribute("data-callout")??"",this.metadata=t.getAttribute("data-callout-metadata")??"",e&&this.init()}get title(){return this.titleEl?.textContent??""}set title(t){this.titleEl.textContent=t}get collapsed(){return this._collapsed}set collapsed(t){this.toggle(t)}toggle(t){2!=this.foldType&&(void 0===t&&(t=!this._collapsed),this.calloutEl?.classList.toggle("is-collapsed",t),this.foldIconEl?.classList.toggle("is-collapsed",t),t?d(this.contentEl,150):u(this.contentEl,150),this._collapsed=t)}collapse(){this.toggle(!0)}expand(){this.toggle(!1)}init(){this.foldIconEl&&this.foldIconEl.addEventListener("click",(()=>{this.toggle()}))}},x=class{static initializeLinks(t){t?.querySelectorAll(".internal-link, a.tag, a.tree-item-self, a.footnote-link").forEach((function(t){t.addEventListener("click",(function(e){let i=t.getAttribute("href");if(e.preventDefault(),e.stopPropagation(),!i)return void console.log("No target found for link");const s=ObsidianSite.document.pathname.split("#")[0].split("?")[0];(i.startsWith("#")||i.startsWith("?"))&&(i=s+i),ObsidianSite.loadURL(i)}))}))}static getPathnameFromURL(t){return""==t||"/"==t||"\\"==t?"/index.html":t.startsWith("#")||t.startsWith("?")?ObsidianSite.document.pathname+t:t.split("?")[0].split("#")[0]}},T=class{constructor(t,e){this.parent=void 0,this.collapsible=!1,this.collapseEl=void 0,this.line=0,this.itemEl=t,this.parent=e,this.line=parseInt(this.itemEl.getAttribute("data-line")??"0"),this.collapseEl=Array.from(this.itemEl.children).find((t=>t.classList.contains("list-collapse-indicator")));const i=this.itemEl.querySelector("ol, ul");if(i&&(this.child=new _(i,this),this.collapseEl)){this.collapsible=!0;const t=this;this.collapseEl.addEventListener("click",(function(e){t.isCollapsed=!t.isCollapsed,e.stopPropagation()}))}}get isChecked(){return this.itemEl.classList.contains("is-checked")}get isCollapsed(){return this.itemEl.classList.contains("is-collapsed")}set isCollapsed(t){this.itemEl.classList.toggle("is-collapsed",t),this.collapseEl&&this.collapseEl.classList.toggle("is-collapsed",t)}get textContent(){return Array.prototype.filter.call(this.itemEl.childNodes,(t=>t.nodeType===Node.TEXT_NODE)).map((t=>t.textContent)).join("").trim()}get htmlContent(){return this.itemEl.innerHTML}},_=class{constructor(t,e){if(this.children=[],this.parent=void 0,"OL"!=t.tagName&&"UL"!=t.tagName)throw new Error("Invalid list element");this.listType="OL"==t.tagName?"ordered":t.classList.contains("contains-task-list")?"checklist":"unordered",this.listEl=t,this.parent=e;Array.from(this.listEl.children).filter((t=>"LI"==t.tagName)).forEach((t=>{this.children.push(new T(t,this))}))}get linearList(){let t=[];return this.children.forEach((e=>{t.push(e),e.child&&(t=t.concat(e.child.linearList))})),t}},A=class{constructor(t,e=5e3){this.message=t,this.duration=e,this.show()}show(){A.container||(A.container=document.createElement("div"),A.container.classList.add("notice-container"),A.container.style.top="0",A.container.style.right="0",document.body.appendChild(A.container)),this.notification=document.createElement("div"),this.notification.classList.add("notice"),this.notification.innerHTML=this.message,A.container.appendChild(this.notification),this.notification.style.opacity="0",this.notification.style.transform="translateX(350px)",this.notification.style.transition="all 0.5s",setTimeout((()=>{this.notification.style.opacity="1",this.notification.style.transform="translateX(0)",this.notification.style.height=this.notification.scrollHeight+"px"}),100),setTimeout((()=>{this.dismiss()}),this.duration),this.notification.addEventListener("click",(()=>{this.dismiss()}),{once:!0})}dismiss(){this.notification&&(this.notification.style.opacity="0",this.notification.style.height="0",this.notification.style.margin="0",this.notification.style.padding="0",setTimeout((()=>{this.notification.remove()}),500))}},P=class extends S{constructor(t){super(ObsidianSite.metadata.featureOptions.tags,"tags"),this.tagNames=t,this.tagElements=[];for(let e of t){const t=document.createElement("a");t.classList.add("tag"),t.setAttribute("href",`?query=tag:${e.replace("#","")}`),t.innerText=e,this.contentEl.appendChild(t),this.tagElements.push(t)}}},O=class{constructor(t){if(this.title="",this.headers=[],this.callouts=[],this.lists=[],this.children=[],this.initialized=!1,this._exists=!1,(t=t.trim()).startsWith("http")||t.startsWith("www")||t.startsWith("/")||t.startsWith("\\"))return void console.error("Please use a relative path from the root of the wesite to load a webpage");""!=t&&"/"!=t&&"\\"!=t||(t="/index.html"),(t.startsWith("#")||t.startsWith("?"))&&(t=ObsidianSite.document.pathname+t),this.pathname=x.getPathnameFromURL(t);const e=new URL(window.location.origin+"/"+t);if(this.hash=e.hash,this.query=e.search,this.queryParameters=e.searchParams,this.info=ObsidianSite.getWebpageData(this.pathname),!this.info)return new A("This page does not exist yet."),void console.warn("This page does not exist yet.",this.pathname);this._exists=!0,this.documentType=this.info.type,console.log("Document type",this.documentType,this.info.type),this.title=this.info.title}get isRootDocument(){return!this.parent}get bounds(){return r.fromElement(this.documentEl)}get exists(){return this._exists}findElements(){this.sizerEl=this.containerEl.closest(".sizer")??this.containerEl.querySelector(".sizer"),this.documentEl=this.containerEl.closest(".document")??this.containerEl.querySelector(".document"),this.headerEl=this.containerEl.closest(".header")??this.containerEl.querySelector(".header"),this.footerEl=this.containerEl.closest(".footer")??this.containerEl.querySelector(".footer")}async init(){return this.pathname&&!this.initialized&&this.exists?(this.initialized=!0,this.containerEl||(this.containerEl=ObsidianSite.centerContentEl),this.findElements(),this.isRootDocument&&(x.initializeLinks(this.sizerEl??this.documentEl??this.containerEl),this.createCallouts(),this.createLists()),"canvas"==this.documentType&&(this.canvas=new w(this)),this):this}async setAsActive(){if(ObsidianSite.document){let t=this.pathname;"index.html"==t&&(t="/"),ObsidianSite.isHttp||(t=null),history.pushState({pathname:t},this.title,t)}await(ObsidianSite.graphView?.showGraph([this.pathname])),ObsidianSite.fileTree?.findByPath(this.pathname)?.setActive(),ObsidianSite.fileTree?.revealPath(this.pathname),ObsidianSite.graphView?.setActiveNodeByPath(this.pathname),ObsidianSite.document=this}async load(t=null,e=ObsidianSite.centerContentEl){if(!this.pathname||!this.exists)return this;if(!t&&ObsidianSite.document.pathname==this.pathname)return console.log("Already on this page"),new A("This page is already open.",2e3),ObsidianSite.document;let i=ObsidianSite.document;await ObsidianSite.showLoading(!0,e),this.isRootDocument&&await this.setAsActive(),this.parent=t,this.containerEl=e;const s=await ObsidianSite.fetch(this.pathname);if(s?.ok){const i=await s.text(),n=(new DOMParser).parseFromString(i,"text/html");let o=n.querySelector(".document"),a=n.querySelector("#outline");if(o){o=document.adoptNode(o);const t=e.querySelector(".document");t?t.replaceWith(o):e.appendChild(o)}!t&&a&&(a=document.adoptNode(a),document.querySelector("#outline")?.replaceWith(a)),await this.postLoadInit(),await this.loadChildDocuments(),this.initialized=!1}else new A("This document could not be loaded."),console.error("Failed to load document",this.pathname),i?.setAsActive();return await ObsidianSite.showLoading(!1,e),this}async postLoadInit(){return this.findElements(),ObsidianSite.metadata.featureOptions.backlinks.enabled&&this.createBacklinks(),ObsidianSite.metadata.featureOptions.tags.enabled&&this.createTags(),this}createCallouts(){const t=Array.from(this.documentEl.querySelectorAll(".callout"));this.callouts=[];for(const e of t)this.callouts.push(new C(e))}createLists(){const t=Array.from(this.documentEl.querySelectorAll(":is(ul, ol):not(:is(ul, ol) :is(ul, ol))"));this.lists=[];for(const e of t)this.lists.push(new _(e,void 0))}createBacklinks(){const t=this.info.backlinks?.filter((t=>t!=this.pathname));t&&0!=t.length&&(this.backlinkList=new L(t))}createTags(){const t=[];ObsidianSite.metadata.featureOptions.tags.showInlineTags&&this.info.inlineTags&&t.push(...this.info.inlineTags),ObsidianSite.metadata.featureOptions.tags.showFrontmatterTags&&this.info.frontmatterTags&&t.push(...this.info.frontmatterTags),0!=t.length&&(this.tags=new P(t))}async loadChildDocuments(){let t=this,e=0;for(;t;)t=t.parent,e++;if(e>4)return;const i=Array.from(this.documentEl.querySelectorAll("link[itemprop='include-document']")),s=[];for(const t of i){const e=t.getAttribute("href");if(!e)continue;const i=new O(e).load(this,t.parentElement);s.push(i)}const n=(await Promise.all(s)).map((t=>t.init()));let o=await Promise.all(n);console.log("Loaded child documents",o),this.children.push(...o)}getMinReadableWidth(){return 30*parseFloat(getComputedStyle(this.sizerEl).fontSize)}},R=class{search(t,e=7){if(0==t.length)return void this.clear();this.input.value=t,this.input.style.color=7!=e?"var(--text-accent)":"";const i=[];1&e&&i.push("aliases"),2&e&&i.push("headers"),3&e&&i.push("tags"),4&e&&i.push("path"),5&e&&i.push("content");const s=this.index.search(t,{prefix:!0,fuzzy:.2,boost:{title:2,aliases:1.8,headers:1.5,tags:1.3,path:1.1},fields:i});s.length>50&&s.splice(50);const n=[],o=[];for(const e of s){if(e.score<.3*s[0].score&&n.length>4||e.score<.1*s[0].score)break;n.push(e.path);const i=[];let a=!1;for(const s in e.match){if(e.match[s].includes("headers"))for(const n of e.headers)if(n.toLowerCase().includes(s.toLowerCase())&&(i.includes(n)||i.push(n),t.toLowerCase()!=s.toLowerCase())){a=!0;break}if(a)break}o.push(i)}if(ObsidianSite.fileTree?.filter(n),ObsidianSite.fileTree?.sort(((t,e)=>t&&e?n.findIndex((e=>t.path==e))-n.findIndex((t=>e.path==t)):0)),!ObsidianSite.fileTree){const e=document.createElement("div");s.filter((t=>t.path.endsWith(".html"))).slice(0,20).forEach((i=>{const s=document.createElement("div");s.classList.add("search-result");const n=document.createElement("a");n.classList.add("tree-item-self");const o=i.path+"?mark="+encodeURIComponent(t);n.setAttribute("href",o),n.appendChild(document.createTextNode(i.title)),s.appendChild(n),e.append(s)})),this.dedicatedSearchResultsList.replaceChildren(e),this.container.after(this.dedicatedSearchResultsList),x.initializeLinks(this.dedicatedSearchResultsList)}}clear(){this.container?.classList.remove("has-content"),this.input.value="",this.clearCurrentDocumentSearch(),ObsidianSite.fileTree?.unfilter()}async init(){if(this.input=document.querySelector('input[type="search"]'),this.container=this.input?.closest("#search-container"),!this.input||!this.container)return;const t=await ObsidianSite.fetch("lib/search-index.json");if(!t?.ok)return void console.error("Failed to fetch search index");const e=await t.text();try{this.index=MiniSearch.loadJSON(e,{fields:["title","path","tags","headers"]})}catch(t){return void console.error("Failed to load search index: ",t)}const i=document.querySelector("#search-clear-button");return i?.addEventListener("click",(t=>{this.clear()})),this.input.addEventListener("input",(t=>{const e=t.target?.value??"";0!=e.length?this.search(e):this.clear()})),ObsidianSite.fileTree||(this.dedicatedSearchResultsList=document.createElement("div"),this.dedicatedSearchResultsList.setAttribute("id","search-results")),this}async searchCurrentDocument(t){this.clearCurrentDocumentSearch();(function(t){const e=[],i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null);let s;for(;s=i.nextNode();)e.push(s);return e})(ObsidianSite.document.sizerEl).forEach((async e=>{const i=e.nodeValue,s=i?.replace(new RegExp(t,"gi"),(t=>`<mark>${t}</mark>`));if(s&&s!==i){const t=document.createElement("div");t.innerHTML=s;Array.from(t.childNodes).forEach((t=>{t.nodeType!=Node.TEXT_NODE&&t?.setAttribute("class","search-mark"),e?.parentNode?.insertBefore(t,e)})),e?.parentNode?.removeChild(e)}}));const e=document.querySelector(".search-mark");setTimeout((()=>{e&&ObsidianSite.scrollTo(e)}),500)}clearCurrentDocumentSearch(){document.querySelectorAll(".search-mark").forEach((t=>{t.outerHTML=t.innerHTML}))}},M=class{constructor(t){if(this.minWidthEm=15,!t.classList.contains("sidebar"))throw new Error("Invalid sidebar container");this.containerEl=t,this.contentEl=t.querySelector(".leaf-content"),this.topbarEl=t.querySelector(".sidebar-topbar"),this.collapseEl=t.querySelector(".sidebar-collapse-icon"),this.topbarContentEl=t.querySelector(".topbar-content"),this.resizeHandleEl=t.querySelector(".sidebar-handle")??void 0,this._isLeft="left-sidebar"==t.id,this._sidebarID=t.id,this.collapseEl.addEventListener("click",(()=>{this.collapsed=!this.collapsed})),this.minResizeWidth=parseFloat(getComputedStyle(this.resizeHandleEl.parentElement??this.resizeHandleEl).fontSize)*this.minWidthEm,this.collapseWidth=this.minResizeWidth/4,this.setupSidebarResize()}get sidebarID(){return this._sidebarID}get isLeft(){return this._isLeft}get resizing(){return this._resizing}get collapsed(){return this._collapsed}set collapsed(t){this._collapsed=t,!t&&this.floating&&document.body.addEventListener("click",this.clickOutsideCollapse),t&&document.body.removeEventListener("click",this.clickOutsideCollapse),this.containerEl.classList.toggle("is-collapsed",t)}get floating(){return this._floating}set floating(t){this._floating=t,this.containerEl.classList.toggle("floating",t)}get width(){return this.containerEl.offsetWidth}set width(t){const e=`min(max(${t}px, ${this.minWidthEm}em), 40vw)`;t<this.collapseWidth?(this.collapsed=!0,this.containerEl.style.removeProperty("transition-duration")):(this.collapsed=!1,this.containerEl.style.setProperty("--sidebar-width",e),t>this.minResizeWidth&&(this.containerEl.style.transitionDuration="0s"))}setupSidebarResize(){if(!this.resizeHandleEl)return;const t=localStorage.getItem(`${this.sidebarID}-width`);t&&this.containerEl.style.setProperty("--sidebar-width",t);const e=this;function i(t){if(!e.resizing)return;const i=e.isLeft?t.clientX:window.innerWidth-t.clientX;e.width=i}this.resizeHandleEl.addEventListener("pointerdown",(function(t){e._resizing=!0,e.containerEl.classList.add("is-resizing"),document.addEventListener("pointermove",i),document.addEventListener("pointerup",(function(){document.removeEventListener("pointermove",i);const t=getComputedStyle(e.containerEl).getPropertyValue("--sidebar-width");localStorage.setItem(`${e.sidebarID}-width`,t),e.containerEl.classList.remove("is-resizing"),e.containerEl.style.removeProperty("transition-duration")}))})),this.resizeHandleEl.addEventListener("dblclick",(function(t){e.resetWidth()}))}resetWidth(){this.containerEl.style.removeProperty("transition-duration"),this.containerEl.style.removeProperty("--sidebar-width"),localStorage.removeItem(`${this.sidebarID}-width`)}clickOutsideCollapse(t){t.target?.closest(".sidebar")||(this.collapsed=!0)}},N=class{constructor(t,e){this._path="",this.collapseAnimationLength=150,this._oldAnimationLength=this.collapseAnimationLength,this.root=this instanceof F?this:e?.root??(e instanceof F?e:void 0),this.parent=e,this.itemEl=t,this.selfEl=t.querySelector(".tree-item-self"),this.collapseIconEl=this.selfEl.querySelector(".collapse-icon"),this.innerEl=this.selfEl.querySelector(".tree-item-inner"),this.childrenEl=t.querySelector(".tree-item-children");const i=this.selfEl.getAttribute("href");i&&(this.path=i),this.children=[];if(Array.from(this.childrenEl.children).filter((t=>t.classList.contains("tree-item"))).forEach((t=>{this.children.push(new N(t,this))})),this._isFolder=this.itemEl.classList.contains("nav-folder"),this._isLink="A"==this.selfEl.tagName,this._isCollapsible=this.itemEl.classList.contains("mod-collapsible"),this.collapsed=this.itemEl.classList.contains("is-collapsed"),this._isCollapsible){(this.isLink?this.collapseIconEl??this.selfEl:this.selfEl).addEventListener("click",(()=>{this.collapsed=!this.collapsed}))}this._checkAnyChildrenOpen()}get path(){return this._path}set path(t){this.root.pathToItem&&(this.root.pathToItem.delete(this._path),this.root.pathToItem.set(t,this)),this._path=t,this.selfEl.setAttribute("href",t)}get title(){return this.innerEl.innerHTML}set title(t){this.innerEl.innerHTML=t}get isFolder(){return this._isFolder}get isLink(){return this._isLink}get collapsable(){return this._isCollapsible}get collapsed(){return this._collapsed}set collapsed(t){this.collapsed!=t&&(!t&&this.parent instanceof N&&this.parent.collapsed&&(this.parent.collapsed=!1),this._collapsed=t,this.itemEl.classList.toggle("is-collapsed",t),this.collapseIconEl?.classList.toggle("is-collapsed",t),t?d(this.childrenEl,this.collapseAnimationLength):u(this.childrenEl,this.collapseAnimationLength),this.parent?._checkAnyChildrenOpen())}get collapsedRecursive(){return this._collapsedRecursive}set collapsedRecursive(t){this.collapsedRecursive!=t&&(this._collapsedRecursive=t,this.children.forEach((e=>{e.collapsed=t,e.collapsedRecursive=t})))}get anyChildrenOpen(){return this._anyChildrenOpen}_checkAnyChildrenOpen(){return this._anyChildrenOpen=this.children.some((t=>!t.collapsed&&t.collapsable)),this._collapsedRecursive=!this._anyChildrenOpen,this._anyChildrenOpen}forAllChildren(t){this.children.forEach((e=>{t(e),e.forAllChildren(t)}))}overrideAnimationLength(t){this._oldAnimationLength=this.collapseAnimationLength,this.collapseAnimationLength=t,this.children.forEach((e=>{e.overrideAnimationLength(t)}))}restoreAnimationLength(){this.collapseAnimationLength=this._oldAnimationLength,this.children.forEach((t=>{t.restoreAnimationLength()}))}setActive(){this.root.activeItem&&this.root.activeItem.selfEl.classList.remove("is-active"),this.root.activeItem=this,this.selfEl.classList.add("is-active")}setFiltered(t){t?this.itemEl.classList.add("filtered-out"):(this.itemEl.classList.remove("filtered-out"),this.parent?.setFiltered(!1))}filter(t){this.overrideAnimationLength(0),this.itemEl.classList.add("filtered"),this.collapsedRecursive=!1,this.forAllChildren((t=>{t.setFiltered(!0)})),t.forEach((t=>{const e=this.findByPath(t);e&&e.setFiltered(!1)}))}async unfilter(){this.itemEl.classList.remove("filtered"),this.forAllChildren((t=>{t.setFiltered(!1)})),this.collapsedRecursive=!0,this.restoreAnimationLength()}sort(t){this.itemEl.classList.add("sorted"),this.children.sort(t),this.children.forEach((e=>{e.sort(t)})),this.children.forEach((t=>{this.childrenEl.appendChild(t.itemEl)}))}unsort(){this.itemEl.classList.remove("sorted"),this.sort(((t,e)=>(ObsidianSite.getWebpageData(t.path)?.treeOrder??0)-(ObsidianSite.getWebpageData(e.path)?.treeOrder??0)))}find(t){if(t(this))return this;for(const e of this.children){const i=e.find(t);if(i)return i}}findByPath(t){return this.root.pathToItem.get(t)}},W=class extends N{constructor(t){const e=t.classList.contains("tree-container")?t:t.querySelector(".tree-container");if(null==e)throw new Error("Invalid tree container");super(e,void 0),this.pathToItem=new Map,this.wrapperEl=e,this.rootEl=this.wrapperEl.querySelector(".mod-root"),this.itemEl=this.rootEl,this.selfEl=this.wrapperEl.querySelector(".mod-root > .tree-item-self"),this.titleEl=this.wrapperEl.querySelector(".mod-root > .nav-folder-title > .nav-folder-title-content"),this.innerEl=this.titleEl,this.childrenEl=this.wrapperEl.querySelector(".mod-root > .nav-folder-children"),this.collapseAllEl=this.wrapperEl.querySelector(".tree-collapse-all");const i=this.collapseAllEl.querySelector("svg");i&&(i.innerHTML="<path d></path><path d></path>",this.collapsePath1=i.querySelector("path"),this.collapsePath2=i.querySelector("path:last-child")),this.forAllChildren((t=>{""!=t.path&&this.pathToItem.set(t.path,t)})),this.collapseAllEl.addEventListener("click",(()=>{this.setCollapseIcon(!this.collapsedRecursive),this.collapsedRecursive=!this.collapsedRecursive})),x.initializeLinks(this.wrapperEl)}_checkAnyChildrenOpen(){const t=super._checkAnyChildrenOpen();return this.setCollapseIcon(!t),t}setCollapseIcon(t){t?(this.collapsePath1?.setAttribute("d",W.collapsePaths[0]),this.collapsePath2?.setAttribute("d",W.collapsePaths[1])):(this.collapsePath1?.setAttribute("d",W.uncollapsePaths[0]),this.collapsePath2?.setAttribute("d",W.uncollapsePaths[1]))}revealPath(t){const e=this.findByPath(t);e&&(e.collapsed=!1)}},F=W;F.collapsePaths=["m7 15 5 5 5-5","m7 9 5-5 5 5"],F.uncollapsePaths=["m7 20 5-5 5 5","m7 4 5 5 5-5"];var I,q,z,D,B,H,V,G,U=class{constructor(){this.nodeCount=0,this.linkCount=0,this.hoveredNode=-1,i(this,g,0),i(this,f,0),i(this,y,0),i(this,E,0),i(this,b,0),this.startPositions=new Float32Array(0),this.linkSources=new Int32Array(0),this.linkTargets=new Int32Array(0),this.radii=new Float32Array(0),this.maxRadius=0,this.averageRadius=0,this.minRadius=0}init(t,i){if(this.free(),this.graphView=t,this.nodeCount=t.nodeCount,this.linkCount=t.linkCount,i?.length!=2*this.nodeCount)throw new Error("Invalid positions array length");this.radii=new Float32Array(t.radii),this.linkSources=new Int32Array(t.linkSources),this.linkTargets=new Int32Array(t.linkTargets),this.maxRadius=this.radii.reduce(((t,e)=>Math.max(t,e))),this.averageRadius=this.radii.reduce(((t,e)=>t+e))/this.radii.length,this.minRadius=this.radii.reduce(((t,e)=>Math.min(t,e))),this.startPositions=new Float32Array(2*this.nodeCount),this.startPositions=this.generatePositions(i),s(this,g,Module._malloc(this.startPositions.byteLength)),s(this,f,this.startPositions.byteLength),s(this,y,Module._malloc(this.radii.byteLength)),s(this,E,Module._malloc(this.linkSources.byteLength)),s(this,b,Module._malloc(this.linkTargets.byteLength)),Module.HEAP32.set(new Int32Array(this.startPositions.buffer),e(this,g)/this.startPositions.BYTES_PER_ELEMENT),Module.HEAP32.set(new Int32Array(this.radii.buffer),e(this,y)/this.radii.BYTES_PER_ELEMENT),Module.HEAP32.set(new Int32Array(this.linkSources.buffer),e(this,E)/this.linkSources.BYTES_PER_ELEMENT),Module.HEAP32.set(new Int32Array(this.linkTargets.buffer),e(this,b)/this.linkTargets.BYTES_PER_ELEMENT),Module._Init(e(this,g),e(this,y),e(this,E),e(this,b),this.nodeCount,this.linkCount,t.batchFraction,t.ticker.deltaTime,t.options.attractionForce,t.options.linkLength,t.options.repulsionForce,t.options.centralForce)}get positions(){return Module.HEAP32.buffer.slice(e(this,g),e(this,g)+e(this,f))}get positionsF(){return new Float32Array(this.positions)}generatePositions(t){let e=new Float32Array(t??new Array(2*this.nodeCount).fill(0));const i=2*this.averageRadius*Math.sqrt(this.nodeCount)*2;for(let t=0;t<this.nodeCount;t++){const s=e[2*t];if(0!=s&&!isNaN(s)&&null!=s)continue;const n=(1-this.radii[t]/this.maxRadius)*i;e[2*t]=Math.cos(t/this.nodeCount*7.41*2*Math.PI)*n,e[2*t+1]=Math.sin(t/this.nodeCount*7.41*2*Math.PI)*n}return e}getBounds(){let t=new r(0,0,0,0);const e=new Float32Array(this.positions);for(let i=0;i<this.nodeCount-1;i+=2){const s=new h(e[i],e[i+1]);t.encapsulatePoint(s.scale(2))}const i=t.center,s=i.magnitude;return t=t.expand(50+s),t.translate(i.inverse),t}update(t,e,i){this.hoveredNode=Module._Update(t.x,t.y,e,i)}free(){Module._free(e(this,g)),Module._free(e(this,y)),Module._free(e(this,E)),Module._free(e(this,b)),Module._FreeMemory()}set batchFraction(t){Module._SetBatchFractionSize(t)}set attractionForce(t){Module._SetAttractionForce(t)}set repulsionForce(t){Module._SetRepulsionForce(t)}set centralForce(t){Module._SetCentralForce(t)}set linkLength(t){Module._SetLinkLength(t)}set dt(t){Module._SetDt(t)}set settleness(t){Module._SetSettleness(t)}};g=new WeakMap,f=new WeakMap,y=new WeakMap,E=new WeakMap,b=new WeakMap;var X=class{constructor(t){i(this,I),i(this,z),i(this,B),i(this,V),this.graph=t,this.canvas=document.querySelector("#graph-canvas"),this.canvasSidebar=this.canvas.closest(".sidebar"),console.log("Creating graph worker");try{this.view=this.canvas.transferControlToOffscreen()}catch(t){console.log("Failed to transfer control to offscreen canvas")}this.worker=new Worker(new URL(ObsidianSite.document.info.pathToRoot+"/lib/scripts/graph-render-worker.js",window.location.href).pathname),this._cameraOffset=new h(0,0),this._cameraScale=1,this._hoveredNode=-1,this._grabbedNode=-1,this._colors={background:0,link:0,node:0,outline:0,text:0,accent:0},this._width=0,this._height=0,this.cameraOffset=new h(this.canvas.width,this.canvas.height).scale(.5),this.cameraScale=1,this.hoveredNode=-1,this.grabbedNode=-1,this.resampleColors(),n(this,I,q).call(this,!0),this.width=this.canvas.width,this.height=this.canvas.height,this.autoResizeCanvas()}get cameraOffset(){return this._cameraOffset}set cameraOffset(t){this._cameraOffset=t,n(this,B,H).call(this,t,this.cameraScale)}get cameraScale(){return this._cameraScale}set cameraScale(t){this._cameraScale=t,n(this,B,H).call(this,this.cameraOffset,t)}get hoveredNode(){return this._hoveredNode}set hoveredNode(t){this._hoveredNode=t,n(this,z,D).call(this,t,this._grabbedNode)}get grabbedNode(){return this._grabbedNode}set grabbedNode(t){this._grabbedNode=t,n(this,z,D).call(this,this._hoveredNode,t)}get colors(){return this._colors}set colors(t){this._colors=t,n(this,V,G).call(this,t)}get width(){return this._width}set width(t){this._width=t,this.resizeCanvas(t,this._height)}get height(){return this._height}set height(t){this._height=t,this.resizeCanvas(this._width,t)}set activeNode(t){this.worker.postMessage({type:"set_active",active:t})}updateData(t){this.graph=t,n(this,I,q).call(this)}sampleColor(t){const e=document.createElement("div");document.body.appendChild(e),e.style.setProperty("display","none"),e.style.setProperty("color","var("+t+")");const i=getComputedStyle(e).color,s=getComputedStyle(e).opacity;e.remove();const n=function(t){const e=t.match(/rgb?\((\d+),\s*(\d+),\s*(\d+)\)/);return e?{red:parseInt(e[1]),green:parseInt(e[2]),blue:parseInt(e[3]),alpha:1}:null}(i);return{a:parseFloat(s)*(n?.alpha??1),rgb:(n?.red??8912896)<<16|(n?.green??34816)<<8|(n?.blue??136)}}resampleColors(){this.colors={background:this.sampleColor("--background-secondary").rgb,link:this.sampleColor("--graph-line").rgb,node:this.sampleColor("--graph-node").rgb,outline:this.sampleColor("--graph-line").rgb,text:this.sampleColor("--graph-text").rgb,accent:this.sampleColor("--interactive-accent").rgb}}draw(t){this.worker.postMessage({type:"draw",positions:t},[t])}resizeCanvas(t,e){this.worker.postMessage({type:"resize",width:t,height:e}),this._width=t,this._height=e}autoResizeCanvas(){this.width==this.canvas.offsetWidth&&this.height==this.canvas.offsetHeight||(this.centerCamera(),this.resizeCanvas(this.canvas.offsetWidth,this.canvas.offsetHeight))}centerCamera(){this.cameraOffset=new h(this.width,this.height).scale(.5)}toScreenSpace(t,e,i=!0){let s=t*this.cameraScale+this.cameraOffset.x,n=e*this.cameraScale+this.cameraOffset.y;return i&&(s=Math.floor(s),n=Math.floor(n)),new h(s,n)}vecToScreenSpace(t,e=!0){return this.toScreenSpace(t.x,t.y,e)}toWorldspace(t,e){const i=(t-this.cameraOffset.x)/this.cameraScale,s=(e-this.cameraOffset.y)/this.cameraScale;return new h(i,s)}vecToWorldspace(t){return this.toWorldspace(t.x,t.y)}setCameraCenterWorldspace(t){this.cameraOffset=new h(this.width/2-t.x*this.cameraScale,this.height/2-t.y*this.cameraScale)}getCameraCenterWorldspace(){return this.toWorldspace(this.width/2,this.height/2)}};I=new WeakSet,q=function(t=!1){const{width:e,height:i}=this.view;let s={width:e,height:i,view:this.view},n=[this.view];t||(s={width:e,height:i},n=[]),this.worker.postMessage({type:"init",linkCount:this.graph.graphSim.linkCount,linkSources:this.graph.graphSim.linkSources,linkTargets:this.graph.graphSim.linkTargets,nodeCount:this.graph.graphSim.nodeCount,radii:this.graph.graphSim.radii,labels:this.graph.labels,linkLength:this.graph.options.linkLength,edgePruning:this.graph.options.edgePruning,options:s},n)},z=new WeakSet,D=function(t,e){const i={type:"update_interaction",hoveredNode:t,grabbedNode:e};this.worker.postMessage(i)},B=new WeakSet,H=function(t,e){this.worker.postMessage({type:"update_camera",cameraOffset:t,cameraScale:e})},V=new WeakSet,G=function(t){this.worker.postMessage({type:"update_colors",colors:t})};var $=class{constructor(){this.batchFraction=1,this.graphExpanded=!1,this._paused=!1,this._isGlobalGraph=!1,this.eventsInitialized=!1,this.updateRunning=!1,this.mouseWorldPos=new h(0,0),this.scrollVelocity=0,this.firstUpdate=!0,this.graphSim=new U,this.options=ObsidianSite.metadata.featureOptions.graphView,this.graphContainer=document.querySelector(".graph-view-container"),this.globalGraphButton=document.querySelector(".graph-global.graph-icon"),this.expandGraphButton=document.querySelector(".graph-expand.graph-icon"),this.ticker=new c(60),this.ticker.add(this.update.bind(this)),this.ticker.start()}get options(){return this._options}set options(t){this._options=t,this.graphSim.attractionForce=t.attractionForce,this.graphSim.centralForce=t.centralForce,this.graphSim.linkLength=t.linkLength,this.graphSim.repulsionForce=t.repulsionForce/this.batchFraction}get paused(){return this._paused}set paused(t){this._paused=t}get isGlobalGraph(){return this._isGlobalGraph}set isGlobalGraph(t){this._isGlobalGraph=t}initEvents(){const t=this;function e(e){const i=t.graphRenderer.canvas.getBoundingClientRect(),s=p(e);return new h(s.x-i.left,s.y-i.top)}let i=new h(0,0),s=new h(0,0),n=new h(0,0),o=new h(0,0),a=0,r=!1,l=!1,c=new h(0,0),d=-1,u=!1;const g=this.graphContainer,f=this.graphRenderer;this.graphRenderer.canvas.addEventListener("pointerenter",(function(p){let y=0,E=!1;function b(a){i=e(a),t.mouseWorldPos=f.vecToWorldspace(i),n=new h(i.x-s.x,i.y-s.y),s=i,-1!=f.grabbedNode&&(o=new h(i.x-c.x,i.y-c.y)),r&&-1!=f.hoveredNode&&-1==f.grabbedNode&&f.hoveredNode!=f.grabbedNode&&(f.grabbedNode=f.hoveredNode),r&&-1==f.hoveredNode&&-1==f.grabbedNode||l?f.cameraOffset=new h(f.cameraOffset.x+n.x,f.cameraOffset.y+n.y):-1!=f.hoveredNode?f.canvas.style.cursor="pointer":f.canvas.style.cursor="default"}function v(o){if(1==o.touches?.length)return E&&(s=e(o),E=!1),void b(o);if(2==o.touches?.length){const a=m(o.touches[0]),r=m(o.touches[1]);i=e(o),n=new h(i.x-s.x,i.y-s.y),s=i;const l=Math.sqrt(Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2));E||(E=!0,y=l,n=new h(0,0),t.mouseWorldPos=h.Undefined,f.grabbedNode=-1,f.hoveredNode=-1);const c=(l-y)/y;t.scaleAround(f.vecToWorldspace(i),1+c,.15,15),f.cameraOffset=new h(f.cameraOffset.x+n.x,f.cameraOffset.y+n.y),y=l}}function w(e){document.removeEventListener("pointerup",w);const i=Date.now();setTimeout((()=>{r&&-1!=f.hoveredNode&&Math.abs(o.x)<=4&&Math.abs(o.y)<=4&&i-a<300&&t.navigateToNode(f.hoveredNode),r&&-1!=f.grabbedNode&&(f.grabbedNode=-1),0==e.button&&(r=!1),"touch"==e.pointerType&&d==e.pointerId&&(d=-1,r=!1),1==e.button&&(l=!1),u||(document.removeEventListener("mousemove",b),document.removeEventListener("touchmove",v))}),0)}function S(e){document.addEventListener("pointerup",w),t.mouseWorldPos=f.vecToWorldspace(i),o=new h(0,0),0==e.button&&(r=!0),"touch"==e.pointerType&&-1==d&&(d=e.pointerId,r=!0),1==e.button&&(l=!0),c=i,a=Date.now()}i=e(p),t.mouseWorldPos=f.vecToWorldspace(i),s=e(p),u=!0,document.addEventListener("mousemove",b),document.addEventListener("touchmove",v),g.addEventListener("pointerdown",S),g.addEventListener("pointerleave",(function e(i){setTimeout((()=>{u=!1,r||(document.removeEventListener("mousemove",b),document.removeEventListener("touchmove",v),t.mouseWorldPos=h.Undefined),g.removeEventListener("pointerdown",S),g.removeEventListener("pointerleave",e)}),1)}))})),this.expandGraphButton?.addEventListener("click",(e=>{e.stopPropagation(),t.toggleExpandedGraph()})),this.globalGraphButton?.addEventListener("click",(e=>{e.stopPropagation(),t.isGlobalGraph?t.showGraph([ObsidianSite.document.pathname]):t.showGraph()})),g.addEventListener("wheel",(function(e){const i=.02;e.deltaY>0?(t.scrollVelocity>=-.02&&(t.scrollVelocity=-.02),t.scrollVelocity*=1.1):(t.scrollVelocity<=i&&(t.scrollVelocity=i),t.scrollVelocity*=1.1)})),g.addEventListener("dblclick",(function(e){t.fitToNodes()})),document.querySelector(".theme-toggle-input")?.addEventListener("change",(t=>{setTimeout((()=>f.resampleColors()),0)}))}async generate(t){this.paths=t,this.nodeCount=this.paths.length,this.linkSources=[],this.linkTargets=[],this.labels=[],this.radii=[];const e=[];for(let t=0;t<this.nodeCount;t++)e.push(0);let i=0;for(const t of this.paths){const s=ObsidianSite.getWebpageData(t);if(!s)continue;this.labels.push(s.title);const n=s.links.map((t=>x.getPathnameFromURL(t))).concat(s.attachments).concat(s.backlinks);let o=[...new Set(n)];o.push(t);for(const t of o){const s=this.paths.indexOf(t);-1!=s&&(this.linkSources.push(s),this.linkTargets.push(i),e[i]++,e[s]++)}i++}const s=Math.max(...e);this.radii=e.map((t=>function(t,e,i){let s=2*(i/=2)*(1-i)+.5;return s-=.5,s*=2,t+(e-t)*s}(this.options.minNodeRadius,this.options.maxNodeRadius,Math.min(t/(.8*s),1)))),this.linkCount=this.linkSources.length}async showGraph(t){this.paused=!0;let e=[];if(t){for(const i of t){const t=ObsidianSite.getWebpageData(i);t?.backlinks&&e.push(...t.backlinks),t?.links&&e.push(...t.links.map((t=>x.getPathnameFromURL(t)))),t?.attachments&&e.push(...t.attachments)}e.push(...t)}else e=ObsidianSite.metadata.allFiles;e.length==ObsidianSite.metadata.allFiles.length?this.isGlobalGraph=!0:this.isGlobalGraph=!1,e=e.filter((t=>ObsidianSite.getWebpageData(t)));const i=[...new Set(e)],s=new Array(2*i.length).fill(0);if(this.paths?.length>0){const t=this.graphSim.positionsF;for(let e=0;e<i.length;e++){const n=i[e],o=this.paths.indexOf(n);-1!=o&&(s[2*e]=t[2*o],s[2*e+1]=t[2*o+1])}}await this.generate(i),this.graphSim.init(this,s),this.graphRenderer?this.graphRenderer.updateData(this):this.graphRenderer=new X(this),this.fitToNodes(),this.eventsInitialized||(this.initEvents(),this.eventsInitialized=!0),this.paused=!1;this.globalGraphButton.innerHTML=this.isGlobalGraph?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-circle-dot"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="1"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-git-fork"><circle cx="12" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><circle cx="18" cy="6" r="3"/><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"/><path d="M12 12v3"/></svg>',this.setActiveNodeByPath(ObsidianSite.document.pathname)}fitToNodes(){this.graphRenderer.centerCamera(),this.graphRenderer.cameraScale=1/Math.sqrt(this.nodeCount)*this.graphRenderer.canvas.width/200,this.graphSim.settleness=1}update(t){!this.paused&&this.graphRenderer&&this.graphSim&&(this.firstUpdate&&(setTimeout((()=>this.graphRenderer?.canvas?.classList.remove("hide")),500),this.firstUpdate=!1),this.graphSim.dt=t,this.graphRenderer.autoResizeCanvas(),this.graphSim.update(this.mouseWorldPos,this.graphRenderer.grabbedNode,this.graphRenderer.cameraScale),this.graphSim.hoveredNode!=this.graphRenderer.hoveredNode&&(this.graphRenderer.hoveredNode=this.graphSim.hoveredNode,this.graphRenderer.canvas.style.cursor=-1==this.graphSim.hoveredNode?"default":"pointer"),this.graphRenderer.draw(this.graphSim.positions),0!=this.scrollVelocity&&(Math.abs(this.scrollVelocity)<.001&&(this.scrollVelocity=0),this.zoomAround(this.mouseWorldPos,this.scrollVelocity),this.scrollVelocity*=1-10*t))}zoomAround(t,e,i=.15,s=15){const n=this.graphRenderer.getCameraCenterWorldspace();if(this.graphRenderer.cameraScale=Math.max(Math.min(this.graphRenderer.cameraScale+e*this.graphRenderer.cameraScale,s),i),this.graphRenderer.cameraScale!=i&&this.graphRenderer.cameraScale!=s&&this.scrollVelocity>0&&!this.mouseWorldPos.isUndefined){const i=new h(t.x-n.x,t.y-n.y),s=new h(n.x+i.x*e,n.y+i.y*e);this.graphRenderer.setCameraCenterWorldspace(s)}else this.graphRenderer.setCameraCenterWorldspace(n)}scaleAround(t,e,i=.15,s=15){const n=this.graphRenderer.getCameraCenterWorldspace(),o=this.graphRenderer.cameraScale;this.graphRenderer.cameraScale=Math.max(Math.min(e*this.graphRenderer.cameraScale,s),i);const a=(o-this.graphRenderer.cameraScale)/o;if(this.graphRenderer.cameraScale!=i&&this.graphRenderer.cameraScale!=s&&0!=e){const e=new h(t.x-n.x,t.y-n.y),i=new h(n.x-e.x*a,n.y-e.y*a);this.graphRenderer.setCameraCenterWorldspace(i)}else this.graphRenderer.setCameraCenterWorldspace(n)}async navigateToNode(t){if(t<0||t>=this.nodeCount)return;this.graphExpanded&&this.toggleExpandedGraph();const e=this.paths[t];await ObsidianSite.loadURL(e)}toggleExpandedGraph(){const t=this.graphContainer.clientWidth,e=this.graphContainer.clientHeight;this.graphContainer.classList.add("scale-down");const i=this.graphContainer.animate({opacity:0},{duration:100,easing:"ease-in",fill:"forwards"}),s=this;function n(t){s.graphExpanded&&(t.composedPath().includes(s.graphContainer)?document.addEventListener("pointerdown",n,{once:!0}):s.toggleExpandedGraph())}i.addEventListener("finish",(function(){s.graphContainer.classList.toggle("expanded"),s.graphRenderer.autoResizeCanvas(),s.graphRenderer.centerCamera();const i=s.graphContainer.clientWidth,n=s.graphContainer.clientHeight;s.graphRenderer.cameraScale*=(i/t+n/e)/2,s.graphContainer.classList.remove("scale-down"),s.graphContainer.classList.add("scale-up");s.graphContainer.animate({opacity:1},{duration:200,easing:"ease-out",fill:"forwards"}).addEventListener("finish",(function(){s.graphContainer.classList.remove("scale-up")}))})),this.graphExpanded=!this.graphExpanded,this.graphExpanded?document.addEventListener("pointerdown",n,{once:!0}):document.removeEventListener("pointerdown",n)}getNodeByPath(t){return this.paths.indexOf(t)}setActiveNode(t){t<0||t>=this.nodeCount||(this.graphRenderer.activeNode=t)}setActiveNodeByPath(t){this.setActiveNode(this.getNodeByPath(t))}},Y=class{constructor(){this.themeToggle=document.querySelector(".theme-toggle-input"),this.themeToggle?.addEventListener("change",(t=>{this.switchTheme()}))}switchTheme(){let t="light"==localStorage.getItem("theme")?"dark":"light";this.setTheme(t,!1)}setTheme(t,e=!1){let i="light"==t;this.themeToggle.checked=i;let s="";e&&(s=document.body.style.transition,document.body.style.transition="none"),!this.themeToggle.classList.contains("is-checked")&&i?this.themeToggle.classList.add("is-checked"):this.themeToggle.classList.contains("is-checked")&&!i&&this.themeToggle.classList.remove("is-checked"),i?(document.body.classList.contains("theme-dark")&&document.body.classList.remove("theme-dark"),document.body.classList.contains("theme-light")||document.body.classList.add("theme-light")):(document.body.classList.contains("theme-light")&&document.body.classList.remove("theme-light"),document.body.classList.contains("theme-dark")||document.body.classList.add("theme-dark")),e&&setTimeout((function(){document.body.style.transition=s}),100),localStorage.setItem("theme",i?"light":"dark")}};window.ObsidianSite=new class{constructor(){this.isLoaded=!1,this.isHttp="file:"!=window.location.protocol,this.fileTree=void 0,this.outlineTree=void 0,this.search=void 0,this.leftSidebar=void 0,this.rightSidebar=void 0,this.graphView=void 0,this.onloadCallbacks=[]}onDocumentLoad(t){this.onloadCallbacks.push(t)}async init(){window.addEventListener("load",(()=>ObsidianSite.onInit())),this.metadata=await this.loadWebsiteData(),this.metadata||console.error("Failed to load website data.")}async onInit(){await a((()=>null!=this.metadata)),console.log("Website init"),"file:"!=window.location.protocol&&await loadIncludes(),this.theme=new Y,this.bodyEl=document.body,this.websiteEl=document.querySelector("#layout"),this.centerContentEl=document.querySelector("#center-content");const t=document.querySelector("#file-explorer"),e=document.querySelector("#outline-tree"),i=document.querySelector(".sidebar#left-sidebar"),s=document.querySelector(".sidebar#right-sidebar");this.createLoadingEl(),t&&(this.fileTree=new F(t)),e&&(this.outlineTree=new F(e)),i&&(this.leftSidebar=new M(i)),s&&(this.rightSidebar=new M(s)),this.search=await(new R).init();const n=document.querySelector("meta[name='pathname']")?.getAttribute("content")??"unknown";this.entryPage=n,this.document=await(await new O(n).init()).postLoadInit(),ObsidianSite.metadata.featureOptions.graphView.enabled&&this.loadGraphView().then((()=>this.graphView?.showGraph([n]))),this.initEvents(),this.isLoaded=!0,this.onloadCallbacks.forEach((t=>t(this.document)))}initEvents(){window.addEventListener("popstate",(async t=>{console.log("popstate",t);const e=t.state.pathname;ObsidianSite.loadURL(e)}))}async loadURL(t){if(t=x.getPathnameFromURL(t),!ObsidianSite.getWebpageData(t))return new A("This page does not exist yet."),void console.warn("Page does not exist",t);let e=await(await new O(t).load()).init();return this.onloadCallbacks.forEach((t=>t(this.document))),e}async fetch(t){if(t=x.getPathnameFromURL(t),this.isHttp||t.startsWith("http")){const e=await fetch(t);return e.ok?e:void console.error("Failed to fetch",t)}var e=this.metadata.fileInfo[t];if(!e?.data)return void console.error("Failed to fetch",t);return new Response(e.data,{status:200})}async loadWebsiteData(){if(!this.isHttp){const t=document.querySelector("data#website-metadata");if(!t)return;return JSON.parse(decodeURI(t.getAttribute("value")??""))}try{const t=await fetch("lib/metadata.json");if(t.ok)return await t.json();console.log("Failed to load website metadata.")}catch(t){console.log("Failed to load website metadata.",t)}}async loadGraphView(){const t=this;waitLoadScripts(["pixi","graph-render-worker","graph-wasm"],(()=>{async function e(){console.log("Initializing graph view");const e=new $;t.graphView=e,console.log("Graph view initialized")}console.log("scripts loaded"),Module.onRuntimeInitialized=e,setTimeout((()=>{console.log(t.graphView),null==t.graphView&&e()}),300)})),await a((()=>null!=this.graphView))}getWebpageData(t){if(this.metadata){const e=this.metadata.webpages[t];if(e)return e}}scrollTo(t){t.scrollIntoView()}async showLoading(t,e=this.centerContentEl){if(e.style.transitionDuration="",e.classList.toggle("hide",t),this.loadingEl.classList.toggle("show",t),this.graphView?.graphRenderer?.canvas.classList.toggle("hide",t),t){const t=r.fromElement(e);this.loadingEl.style.left=t.center.x-this.loadingEl.offsetWidth/2+"px",this.loadingEl.style.top=t.center.y-this.loadingEl.offsetHeight/2+"px"}await o(200)}createLoadingEl(){this.loadingEl=document.createElement("div"),this.loadingEl.classList.add("loading-icon"),document.body.appendChild(this.loadingEl),this.loadingEl.innerHTML="<div></div><div></div><div></div><div></div>"}get documentBounds(){return r.fromElement(this.centerContentEl)}},ObsidianSite=window.ObsidianSite,window.WebpageDocument=O,window.Canvas=w,window.Bounds=r,window.Vector2=h,window.LinkHandler=x,window.Search=R,ObsidianSite.init()})()